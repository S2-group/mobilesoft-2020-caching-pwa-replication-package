rblms.define("utils/settings_methods",["underscore","require"],function(i){return function(){this._isCustom=function(){return(this.is_custom_domain||this.inEmbed)&&!this.isRoar()},this.isRoar=function(){var i=this.site||{};return!(!i.is_roar&&!i.is_roar_subsite)},this.getRoarId=function(){return this.site.is_roar?this.site.id:this.site.is_roar_subsite?this.site.parent_id:this.site.whitelabel_settings&&this.site.whitelabel_settings.site_id},this.isDiscoverySelfDriveEnabled=function(){return!0===this.social_outbox.self_driving_discovery_email_pings_enabled||!0===this.social_outbox.self_driving_discovery_fb_pings_enabled},this.is=function(i,t){return i=/^is\_/.test(i)?i:"is_"+i,!!((t=t||"is_custom_domain"===i||"is_paid_domain"===i)?this[i]:!this._isCustom()&&this[i])},this.getDomain=function(){return this._isCustom()?this.domain_site_name:window.location.protocol+"//"+(this.domain_site_name||window.location.hostname)},this.getCustomDomainOrHostname=function(){return this.site.domain||window.location.hostname},this.getJSURL=function(){var i=require.s.contexts._.config.baseUrl;return 0===i.indexOf(window.location.protocol)?i:this.getDomain()+i},this.getSiteURL=function(i){return i&&i.force_paid&&this.is_paid_domain?this.site.domain||this.domain_site_name:this.getDomain()+(this._isCustom()?"":"/"+(this.site.name||""))},this.getMainSiteId=function(){var i=this.user.can("publish_post",!0,"parent_site");return(this.site.is_roar||this.site.is_roar_subsite)&&i&&this.parent_site?this.parent_site.id:this.site.id},i.isUndefined(this.user)&&(this.user={}),this.user.can=i.bind(function(t,s,e){var r,n,o,h=e||this.site;return this.sites&&i.isNumber(h)&&(h=i.findWhere(this.sites,{id:h})),i.isString(h)&&(h=this[h]),r=h&&h.permissions||{},n=i.clone(r),this.parent_site&&(o=this.parent_site.permissions||{},i.each(o,function(i,t){i&&(n[t]=i)})),!!(s?n[t]:!this._isCustom()&&n[t])},this),this.user.ownsCurrentSite=i.bind(function(){return this.user.id===this.site.owner_id},this),this.buildProviderConnectUrl=function(i,t){return this.providers[i].auth_url+"?"+t},this.engineSettings=function(){return this.engine_settings||{}},this.hasUserFeatureEnabled=function(i,t){if(!this.user.providers[i+"_features"])throw new Error(i+"_features are absent! Make sure server properly generated settings object");return this.user.providers[i+"_features"][t]},this.getCommunities=function(){return i.filter(this.sites,function(i){return"Group"===i.type_name})},this.isUserAdmin=function(i){var t=i||this.site;return this.user.can("delete_all_drafts",!0,t)},this.isUserEditor=function(i){var t=i||this.site;return!this.isUserAdmin(i)&&this.user.can("delete_real_draft",!0,t)},this.isUserGuestEditor=function(i){var t=i||this.site;return!this.isUserAdmin(i)&&!this.isUserEditor(i)&&this.user.can("edit_real_draft",!0,t)},this.isUserGuestWriter=function(i){var t=i||this.site;return!this.isUserAdmin(i)&&!this.isUserEditor(i)&&!this.isUserGuestEditor(i)&&this.user.can("create_real_draft",!0,t)},this.isUserReader=function(i){var t=i||this.site;return!(this.isUserAdmin(i)||this.isUserEditor(i)||this.isUserGuestWriter(i)||this.user.can("create_real_draft",!0,t))},this.isOpenCommunityWriter=function(){return!this.community_site&&this.isUserReader("parent_site")}}});